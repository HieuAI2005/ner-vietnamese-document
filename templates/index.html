<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF to JSON</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>
  <div class="container py-5">
    <!-- Logo -->
    <div class="text-start mb-4">
      <div class="logo-text">
        <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="icon" />
        PDF to JSON
      </div>
    </div>

    <!-- Ti√™u ƒë·ªÅ + m√¥ t·∫£ -->
    <div class="text-center mb-4">
      <h2><strong>Tr√≠ch xu·∫•t d·ªØ li·ªáu t·ª´ PDF</strong></h2>
      <p class="text-muted">T·∫£i l√™n file PDF ho·∫∑c nh·∫≠p URL ƒë·ªÉ h·ªá th·ªëng ph√¢n t√≠ch v√† tr√≠ch xu·∫•t d·ªØ li·ªáu c·∫•u tr√∫c JSON.</p>
    </div>

    <!-- Form upload -->
    <form method="POST" enctype="multipart/form-data" action="/upload">
      
        <!-- V√πng nh·∫≠p URL PDF -->
        <div class="mb-4">
          <div class="upload-box p-3 position-relative">
            <label for="pdf_url" class="form-label fw-bold mb-2 d-block">
              <span style="font-size: 1.2rem;">üåê Nh·∫≠p URL file PDF</span>
            </label>
            <div class="position-relative">
              <input type="url" name="pdf_url" id="pdf_url" class="form-control pe-5" placeholder="https://example.com">
              <!-- Tick xanh -->
              <span id="urlTick" class="position-absolute top-50 end-0 translate-middle-y me-3 d-none">
                  <!-- icon s·∫Ω ƒë∆∞·ª£c thay ƒë·ªïi b·∫±ng JS -->
              </span>
            </div>
          </div>
        </div>


      <!-- V√πng k√©o th·∫£ -->
      <div class="upload-box mb-3" id="uploadBox">
        <div id="uploadPrompt">
          <div class="upload-icon">üì§</div>
          <p class="mb-2">K√©o th·∫£ file PDF v√†o ƒë√¢y</p>
          <p class="text-muted mb-3">ho·∫∑c</p>
          <label for="pdf_file" class="btn btn-choose mb-3">Ch·ªçn file</label>
        </div>

        <!-- Input file ·∫©n -->
        <input type="file" id="pdf_file" name="pdf_file" accept=".pdf" required hidden>

        <!-- Hi·ªÉn th·ªã file ƒë√£ ch·ªçn -->
        <div id="filePreview" class="file-preview d-none mt-4 px-3 py-3 rounded shadow-sm">
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" style="width: 32px; height: 32px; margin-right: 10px;">
              <div>
                <strong id="fileName">T√™n file.pdf</strong><br>
                <small id="fileSize" class="text-muted">0 KB</small>
              </div>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger ms-3" onclick="clearFile()">‚úñ</button>
          </div>
          <div class="progress mt-3" style="height: 6px;">
            <div class="progress-bar progress-bar-striped bg-primary" style="width: 100%;"></div>
          </div>
        </div>
      </div>

      <!-- N√∫t submit -->
      <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary btn-lg px-4">
          üîç Ph√¢n t√≠ch
        </button>
      </div>

      <!-- Th√¥ng b√°o l·ªói -->
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="alert alert-danger mt-4 text-center">{{ messages[0] }}</div>
        {% endif %}
      {% endwith %}
    </form>

    <!-- Footer -->
    <div class="text-center footer mt-5">
      <p>¬© 2025 | PDF to JSON - H·ªá th·ªëng tr√≠ch xu·∫•t d·ªØ li·ªáu vƒÉn b·∫£n</p>
    </div>
  </div>

  <!-- JS -->
  <script>
    const fileInput = document.getElementById('pdf_file');
    const filePreview = document.getElementById('filePreview');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const uploadPrompt = document.getElementById('uploadPrompt');
    const pdfUrlInput = document.getElementById('pdf_url');
    const uploadBox = document.getElementById('uploadBox');
    const urlIcon = document.getElementById('urlTick');

    function validateUrl(url) {
      try {
        const parsed = new URL(url);
        return parsed.protocol === "http:" || parsed.protocol === "https:";
      } catch (_) {
        return false;
      }
    }

    fileInput.addEventListener('change', function () {
      const file = fileInput.files[0];
      if (file) {
        fileName.textContent = file.name;
        fileSize.textContent = (file.size / 1024).toFixed(1) + ' KB';
        filePreview.classList.remove('d-none');
        uploadPrompt.classList.add('d-none');

        // Reset URL input
        pdfUrlInput.disabled = true;
        pdfUrlInput.value = '';
        pdfUrlInput.classList.remove('valid-url');
        urlIcon.classList.add('d-none');
      }
    });

    function clearFile() {
      fileInput.value = '';
      filePreview.classList.add('d-none');
      uploadPrompt.classList.remove('d-none');
      pdfUrlInput.disabled = false;
    }

   pdfUrlInput.addEventListener('input', () => {
      const url = pdfUrlInput.value.trim();

      // Tr∆∞·ªùng h·ª£p: kh√¥ng nh·∫≠p g√¨
      if (url === '') {
        urlIcon.classList.add('d-none');
        urlIcon.innerHTML = '';
        pdfUrlInput.classList.remove('valid-url');
        fileInput.disabled = false;
        uploadBox.classList.remove('disabled');
        return;
      }

      // Tr∆∞·ªùng h·ª£p: URL h·ª£p l·ªá
      if (validateUrl(url)) {
        urlIcon.innerHTML = '<i class="bi bi-check-circle-fill text-success fs-4"></i>';
        urlIcon.classList.remove('d-none');
        pdfUrlInput.classList.add('valid-url');

        // Disable upload file
        fileInput.disabled = true;
        uploadBox.classList.add('disabled');
        clearFile();  // xo√° file n·∫øu ƒëang ch·ªçn
      }

      // Tr∆∞·ªùng h·ª£p: URL sai ƒë·ªãnh d·∫°ng
      else {
        urlIcon.innerHTML = '<i class="bi bi-x-circle-fill text-danger fs-4"></i>';
        urlIcon.classList.remove('d-none');
        pdfUrlInput.classList.remove('valid-url');

        // Cho ph√©p ch·ªçn file tr·ªü l·∫°i
        fileInput.disabled = false;
        uploadBox.classList.remove('disabled');
      }
    });

  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>